<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AR Sun Path</title>
    <style>
        /* ... (keep previous styles) ... */
    </style>
    <script src="https://cdn.jsdelivr.net/npm/suncalc@1.9.0/suncalc.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gyronorm@2.0.6/dist/gyronorm.complete.min.js"></script>
</head>
<body>
    <!-- ... (keep previous HTML structure) ... -->
    
    <script>
        // Init GN for sensor fusion
        const gn = new GyroNorm();
        gn.init().then(() => {
            gn.start((data) => {
                currentGamma = data.do.gamma;
                currentBeta = data.do.beta;
            });
        });

        // Enhanced orientation handler
        function handleOrientation(event) {
            if (!event.absolute) return;
            currentHeading = (360 - event.alpha) % 360;
        }

        // Main AR loop
        function drawAROverlay() {
            const { azimuth, altitude } = updateSunPosition(lat, lon);
            const pos = projectSunToScreen(azimuth, altitude);
            
            // Draw sun indicator
            ctx.beginPath();
            ctx.arc(pos.x, pos.y, 20, 0, Math.PI*2);
            ctx.fillStyle = 'rgba(255, 215, 0, 0.8)';
            ctx.fill();
            
            requestAnimationFrame(drawAROverlay);
        }
    </script>
</body>
</html>